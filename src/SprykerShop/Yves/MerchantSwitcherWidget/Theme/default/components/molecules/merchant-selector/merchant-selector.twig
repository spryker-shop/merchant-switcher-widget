{% extends model('component') %}

{% define config = {
    name: 'merchant-selector',
    tag: 'merchant-selector',
} %}

{% define data = {
    merchantList: required,
    currentMerchantReference: required,
    newMerchantNameTemplate: 'TargetMerchantName',
} %}

{% define attributes = {
    'new-merchant-name-template': data.newMerchantNameTemplate,
    'message-template': 'merchant_switcher.message' | trans({
        '%currentMerchant%': block('currentMerchantName'),
        '%newMerchant%': data.newMerchantNameTemplate,
    }),
} %}

{% block body %}
    <form class="{{ config.jsName }}__form {% block formClass %}{% endblock %}" method="POST" action="{{ path('switch-merchant') }}">
        {% block merchantSelect %}
            {% embed atom('select') with {
                modifiers: ['naked'],
                attributes: {
                    name: 'merchant-reference',
                },
                embed: {
                    jsName: config.jsName,
                    merchantList: data.merchantList,
                    currentMerchantReference: data.currentMerchantReference,
                },
            } only %}
                {% block selectClass %}{{ embed.jsName }}__select{% endblock %}

                {% block options %}
                    {% for merchant in embed.merchantList %}
                        {% if merchant.merchantKey == embed.currentMerchantReference %}
                            {% block currentMerchantName %}
                                {{- merchant.name -}}
                            {% endblock %}
                            <option value="{{ merchant.merchantKey }}" selected>
                                {{ block('currentMerchantName') }}
                            </option>
                        {% else %}
                            <option value="{{ merchant.merchantKey }}">
                                {{ merchant.name }}
                            </option>
                        {% endif %}
                    {% endfor %}
                {% endblock %}
            {% endembed %}
        {% endblock %}
    </form>
{% endblock %}
